<?session_start();ob_start();$maxExecutionTime = 300;ini_set("max_execution_time", $maxExecutionTime);header("Content-type: text/html; charset=iso-8859-1");$lvStr_Contrasena	= "fcb1ccbc7f6489261396396c7d7915db";$urlSitio			= "https://prodapp2.seace.gob.pe/seacebus-uiwd-pub/buscadorPublico/buscadorPublico.xhtml";if (!function_exists('curl_init')){	fn_Error("cURL is not installed. Install and try again.");	die();}function fn_ConvertirANumero($cadena){	$valor	= $cadena;	$offset	= strpos($valor, ".");	if ($offset !== false)	{		$valor	= substr($valor, 0, $offset);	};	$valor	= str_replace(",", "", $valor);	if (is_numeric($valor))	{		$resultado	= (float) $valor;	}	else	{		$resultado	= 0;	}	return $resultado;}function fn_EsRuc($cadena){	$resultado	= true;	for ($i = 0; $i < strlen($cadena); $i++)	{		$caracter	= substr($cadena, $i, 1);		if ($caracter != "0" && $caracter != "1" && $caracter != "2" && $caracter != "3" && $caracter != "4" && $caracter != "5" && $caracter != "6" && $caracter != "7" && $caracter != "8" && $caracter != "9" && $caracter != "L")		{			$resultado = false;			break;		};	}	return $resultado;}function fn_TextoAjax($texto){	$texto	= str_replace(chr(10), "", $texto);	$texto	= str_replace(chr(13), "", $texto);	$texto	= str_replace(chr(0), "", $texto);	$texto	= str_replace(chr(39), chr(39)." + String.fromCharCode(39) + ".chr(39), $texto);	return $texto;}function fn_Error($msgError){	echo("fn_MostrarError('".fn_TextoAjax($msgError)."');");	echo("fn_HabilitarBotones();");}function fn_LimpiarSesion($nombreArchivoCaptcha, $nombreArchivoCookie){	if ($nombreArchivoCaptcha != "")	{		if (file_exists ("captcha/".$nombreArchivoCaptcha))			unlink ("captcha/".$nombreArchivoCaptcha);	}	if ($nombreArchivoCookie != "")	{		if (file_exists ("cookies/".$nombreArchivoCookie))			unlink ("cookies/".$nombreArchivoCookie);	}}function fn_BloqueTexto($origen, $bloqueInicio, $bloqueFin){	$pos1 = strpos($origen, $bloqueInicio);	if ($pos1 !== false)	{		$pos2	= strpos($origen, $bloqueFin, $pos1);		$bloque	= substr($origen, $pos1 + strlen($bloqueInicio), $pos2 - $pos1 - strlen($bloqueInicio));	}	else	{		$bloque	= "";	};	return $bloque;}function fn_FormatoFechaParaExcel($cadena){	$dia	= substr($cadena, 0, 2);	$mes	= substr($cadena, 3, 2);	$anio	= substr($cadena, 6, 4);	return $anio."-".$mes."-".$dia;}function fn_NombreDepartamentoParaExcel($id){	switch ($id)	{		case "2":		$nombre = "AMAZONAS";						break;		case "3":		$nombre = "ANCASH";						break;		case "4":		$nombre = "APURIMAC";						break;		case "5":		$nombre = "AREQUIPA";						break;		case "6":		$nombre = "AYACUCHO";						break;		case "7":		$nombre = "CAJAMARCA";						break;		case "8":		$nombre = "CALLAO";						break;		case "9":		$nombre = "CUSCO";						break;		case "9997":	$nombre = "EXTERIOR";						break;		case "10":		$nombre = "HUANCAVELICA";						break;		case "11":		$nombre = "HUANUCO";						break;		case "12":		$nombre = "ICA";						break;		case "13":		$nombre = "JUNIN";						break;		case "14":		$nombre = "LA-LIBERTAD";						break;		case "15":		$nombre = "LAMBAYEQUE";						break;		case "16":		$nombre = "LIMA";						break;		case "17":		$nombre = "LORETO";						break;		case "18":		$nombre = "MADRE-DE-DIOS";						break;		case "19":		$nombre = "MOQUEGUA";						break;		case "9994":	$nombre = "MULTIDEPARTAMENTAL";						break;		case "20":		$nombre = "PASCO";						break;		case "21":		$nombre = "PIURA";						break;		case "22":		$nombre = "PUNO";						break;		case "23":		$nombre = "SAN-MARTIN";						break;		case "24":		$nombre = "TACNA";						break;		case "25":		$nombre = "TUMBES";						break;		case "26":		$nombre = "UCAYALI";						break;		default:		$nombre = "";						break;	}	return $nombre;}if (isset($_POST["obtenerCaptcha"])){	if ($_POST["obtenerCaptcha"] == "1")	{		$input1						= "";		$input2						= "";		$input3						= "";		$input4						= "";		$input5						= "";		$codViewState				= "";		$nombreArchivoCookie		= "";		$lvStr_ConError				= "false";		$lvStr_ContrasenaIngresada	= trim($_POST["contrasena"]);		$nombreArchivo				= $_POST["nombreArchivo"];		fn_LimpiarSesion($nombreArchivo, "");		if (md5($lvStr_ContrasenaIngresada) != $lvStr_Contrasena)		{			fn_Error("Contrasena incorrecta.");			$lvStr_ConError			= "true";		}		else		{			$key						= rand(0, 9999);			$paramNombreArchivoCookie	= substr(md5($key), 0, 8);			$nombreArchivoCookie		= "coookie-".date("Y-m-d")."-".$paramNombreArchivoCookie.".txt";			$ch							= curl_init();			curl_setopt($ch, CURLOPT_URL, $urlSitio);			curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);			curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);			curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);			curl_setopt($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:80.0) Gecko/20100101 Firefox/80.0");			curl_setopt($ch, CURLOPT_HEADER, 0);			curl_setopt($ch, CURLOPT_COOKIE, 1);			curl_setopt($ch, CURLOPT_COOKIEJAR, "cookies/".$nombreArchivoCookie);			curl_setopt($ch, CURLOPT_COOKIEFILE, "cookies/".$nombreArchivoCookie);			curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 0);			curl_setopt($ch, CURLOPT_REFERER, $urlSitio);			curl_setopt($ch, CURLOPT_TIMEOUT, 20);			$output					= curl_exec($ch);			$error					= curl_error($ch);			if ($error != "")			{				fn_Error($error);				$lvStr_ConError		= "true";			}			else			{				$output			= utf8_decode($output);				$pos1			= strpos($output, 'id="javax.faces.ViewState" value="');				$pos2			= strpos($output, '" autocomplete="off"', $pos1);				$codViewState	= substr($output, $pos1 + 34, $pos2 - $pos1 - 34);				$pos1			= strpos($output, 'Tipo de Selecci');				$pos2			= strpos($output, '<select id="tbBuscador:idFormBuscarProceso:', $pos1);				$pos3			= strpos($output, '_input', $pos2);				$input1			= substr($output, $pos2 + 43, $pos3 - $pos2 - 43);				$pos1			= strpos($output, 'Objeto de Contrataci');				$pos2			= strpos($output, '<select id="tbBuscador:idFormBuscarProceso:', $pos1);				$pos3			= strpos($output, '_input', $pos2);				$input2			= substr($output, $pos2 + 43, $pos3 - $pos2 - 43);				$pos1			= strpos($output, 'Version SEACE');				$pos2			= strpos($output, '<select id="tbBuscador:idFormBuscarProceso:', $pos1);				$pos3			= strpos($output, '_input', $pos2);				$input3			= substr($output, $pos2 + 43, $pos3 - $pos2 - 43);				$pos1			= strpos($output, 'Modalidad de Selecci');				$pos2			= strpos($output, '<select id="tbBuscador:idFormBuscarProceso:', $pos1);				$pos3			= strpos($output, '_input', $pos2);				$input4			= substr($output, $pos2 + 43, $pos3 - $pos2 - 43);				$pos1			= strpos ($output, 'Identificador Convocatoria');				$pos2			= strpos ($output, '<input type="hidden" id="tbBuscador:idFormBuscarProceso:', $pos1);				$pos3			= strpos ($output, '_collapsed', $pos2);				$input5			= substr ($output, $pos2 + 56, $pos3 - $pos2 - 56);				$data			= array(										'javax.faces.partial.ajax' => true,										'javax.faces.source' => 'tbBuscador:idFormBuscarProceso:btnrefreshcaptcha',										'javax.faces.partial.execute' => @all,										'javax.faces.partial.render' => 'tbBuscador:idFormBuscarProceso:codigoCaptcha tbBuscador:idFormBuscarProceso:captchaImg',										'tbBuscador:idFormBuscarProceso:btnrefreshcaptcha' => 'tbBuscador:idFormBuscarProceso:btnrefreshcaptcha',										'javax.faces.ViewState' => $codViewState										);				curl_setopt($ch, CURLOPT_POST, true);				curl_setopt($ch, CURLOPT_POSTFIELDS, $data);				$output				= curl_exec($ch);				$error				= curl_error($ch);				if ($error != "")				{					fn_Error($error);					$lvStr_ConError	= "true";				}				else				{					$output 		= utf8_decode($output);					$pos1			= strpos($output, '<update id="javax.faces.ViewState">');					$pos2			= strpos($output, '</update>', $pos1);					$codViewState	= substr($output, $pos1 + 44, $pos2 - $pos1 - 47);					$pos1			= strpos($output, "src=");					$pos2			= strpos($output, "alt=", $pos1);					$imgPath		= substr($output, $pos1 + 5, $pos2 - $pos1 - 7);					$imgUrl			= "https://prodapp2.seace.gob.pe".$imgPath;					$imgUrl			= str_replace("amp;", "", $imgUrl);					curl_setopt($ch, CURLOPT_URL, $imgUrl);					curl_setopt($ch, CURLOPT_POST, false);					$output			= curl_exec($ch);					$error			= curl_error($ch);					if ($error != "")					{						fn_Error($error);						$lvStr_ConError	= "true";					}				}			}			curl_close($ch);			if ($lvStr_ConError == "false")			{				$key			= rand(0, 9999);				$nombreArchivo	= "captcha-".substr(md5($key), 0, 8).".jpg";				$fileHandle		= fopen("captcha/".$nombreArchivo, "w");				fwrite($fileHandle, $output);				fclose($fileHandle);			}		};		echo("fn_ResultadoObtencionCaptcha('".fn_TextoAjax($nombreArchivo)."', '".fn_TextoAjax($nombreArchivoCookie)."', '".fn_TextoAjax($input1)."', '".fn_TextoAjax($input2)."', '".fn_TextoAjax($input3)."', '".fn_TextoAjax($input4)."', '".fn_TextoAjax($input5)."', '".fn_TextoAjax($codViewState)."', ".$lvStr_ConError.");");	}}if (isset($_POST["submitirCaptcha"])){	if ($_POST["submitirCaptcha"] == "1")	{		$cantReg					= 0;		$cantPag					= 0;		$lvStr_ConError				= "false";		$nombreArchivoCookie		= $_POST["nombreArchivoCookie"];		$lvStr_ContrasenaIngresada	= trim($_POST["contrasena"]);		if (md5($lvStr_ContrasenaIngresada) != $lvStr_Contrasena)		{			fn_Error("Contrasena incorrecta.");			$lvStr_ConError			= "true";		}		else		{			echo("fn_InicioTabla();");			$input1					= $_POST["input1"];			$input2					= $_POST["input2"];			$input3					= $_POST["input3"];			$input4					= $_POST["input4"];			$input5					= $_POST["input5"];			$valorCaptcha			= trim($_POST["valorCaptcha"]);			$codViewState			= $_POST["codViewState"];			$departamento			= $_POST["departamento"];			$anioConvocatoria		= $_POST["anioConvocatoria"];			$fechaInicio			= $_POST["fechaInicio"];			$fechaFin				= $_POST["fechaFin"];			$valorMinimo			= $_POST["valorMinimo"];			$ch						= curl_init();			curl_setopt($ch, CURLOPT_URL, $urlSitio);			curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);			curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);			curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);			curl_setopt($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:80.0) Gecko/20100101 Firefox/80.0");			curl_setopt($ch, CURLOPT_HEADER, 0);			curl_setopt($ch, CURLOPT_COOKIE, 1);			curl_setopt($ch, CURLOPT_COOKIEJAR, "cookies/".$nombreArchivoCookie);			curl_setopt($ch, CURLOPT_COOKIEFILE, "cookies/".$nombreArchivoCookie);			curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 0);			curl_setopt($ch, CURLOPT_REFERER, $urlSitio);			curl_setopt($ch, CURLOPT_TIMEOUT, 20);			$data = "javax.faces.partial.ajax=true";			$data = $data."&javax.faces.source=tbBuscador%3AidFormBuscarProceso%3AbtnBuscarSel";			$data = $data."&javax.faces.partial.execute=%40all";			$data = $data."&javax.faces.partial.render=tbBuscador%3AidFormBuscarProceso%3ApnlGrdResultadosProcesos+tbBuscador%3AidFormBuscarProceso%3AfooterBuscador+tbBuscador%3AidFormBuscarProceso%3AcodigoCaptcha+frmMesajes%3AgPrincipal+tbBuscador%3AidFormBuscarProceso%3AbtnBuscarSel";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AbtnBuscarSel=tbBuscador%3AidFormBuscarProceso%3AbtnBuscarSel";			$data = $data."&tbBuscador%3AidFormBuscarProceso=tbBuscador%3AidFormBuscarProceso";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AhddNumeroRuc=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AcodigoCaptcha=".$valorCaptcha;			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AnombreEntidad=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input1."_input=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input1."_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input2."_input=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input2."_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AnumeroSeleccion=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdescripcionObjeto=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AanioConvocatoria_input=".$anioConvocatoria;			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AanioConvocatoria_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input3."_input=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input3."_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AcodigoSnip=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AsiglasEntidad=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input4."_input=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input4."_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Adepartamento_input=".$departamento;			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Adepartamento_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Aprovincia_input=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Aprovincia_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Adistrito_input=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Adistrito_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdfechaInicio_input=".urlencode($fechaInicio);			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdfechaFin_input=".urlencode($fechaFin);			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AnumeroConvocatoria=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input5."_collapsed=true";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AtxtNombreEntidad=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AtxtRucEntidad=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Atxtsigla=";			$data = $data."&javax.faces.ViewState=".urlencode($codViewState);			curl_setopt($ch, CURLOPT_POST, true);			curl_setopt($ch, CURLOPT_POSTFIELDS, $data);			$output		= curl_exec($ch);			$error		= curl_error($ch);			if ($error != "")			{				fn_Error($error);				$lvStr_ConError	= "true";			}			else			{				$output			= utf8_decode($output);				$bloque			= fn_BloqueTexto($output, '<span class="ui-paginator-current">', '</span>');				if ($bloque == "")				{					fn_Error("No se encontraron datos (1).");					$lvStr_ConError	= "true";				}				else				{					$cantReg	= (int) fn_BloqueTexto($bloque, 'del total ', ' - ');					$cantPag	= (int) fn_BloqueTexto($bloque, '/', ' ]');					echo("fn_ResultadoSubmitirCaptcha(".$cantPag.", ".$cantReg.");");				}			}			curl_close($ch);		}	}}if (isset($_POST["obtenerDatosPagina"])){	if ($_POST["obtenerDatosPagina"] == "1")	{		$lvStr_ConError				= "false";		$nombreArchivoCookie		= $_POST["nombreArchivoCookie"];		$cantPaginas				= (int) $_POST["cantPaginas"];		$nroPaginaActual			= (int) $_POST["nroPaginaActual"];		$lvStr_ContrasenaIngresada	= trim($_POST["contrasena"]);		if (md5($lvStr_ContrasenaIngresada) != $lvStr_Contrasena)		{			fn_Error("Contrasena incorrecta.");			$lvStr_ConError			= "true";		}		else		{			sleep(1);			$lvBol_PrimerDetalle	= true;			$input1					= $_POST["input1"];			$input2					= $_POST["input2"];			$input3					= $_POST["input3"];			$input4					= $_POST["input4"];			$input5					= $_POST["input5"];			$codViewState			= $_POST["codViewState"];			$valorCaptcha			= trim($_POST["valorCaptcha"]);			$departamento			= $_POST["departamento"];			$anioConvocatoria		= $_POST["anioConvocatoria"];			$fechaInicio			= $_POST["fechaInicio"];			$fechaFin				= $_POST["fechaFin"];			$valorMinimo			= $_POST["valorMinimo"];			$sigNroRegistro			= ($nroPaginaActual - 1) * 15;			$data = "javax.faces.partial.ajax=true";			$data = $data."javax.faces.source=tbBuscador%3AidFormBuscarProceso%3AdtProcesos";			$data = $data."&javax.faces.partial.execute=tbBuscador%3AidFormBuscarProceso%3AdtProcesos";			$data = $data."&javax.faces.partial.render=tbBuscador%3AidFormBuscarProceso%3AdtProcesos";			$data = $data."&javax.faces.behavior.event=page";			$data = $data."&javax.faces.partial.event=page";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdtProcesos_pagination=true";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdtProcesos_first=".$sigNroRegistro;			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdtProcesos_rows=15";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdtProcesos_encodeFeature=true";			$data = $data."&tbBuscador%3AidFormBuscarProceso=tbBuscador%3AidFormBuscarProceso";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AhddNumeroRuc=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AcodigoCaptcha=".$valorCaptcha;			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AnombreEntidad=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input1."_input=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input1."_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input2."_input=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input2."_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AnumeroSeleccion=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdescripcionObjeto=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AanioConvocatoria_input=".$anioConvocatoria;			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AanioConvocatoria_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input3."_input=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input3."_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AcodigoSnip=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AsiglasEntidad=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input4."_input=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input4."_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Adepartamento_input=".$departamento;			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Adepartamento_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Aprovincia_input=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Aprovincia_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Adistrito_input=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Adistrito_focus=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdfechaInicio_input=".urlencode($fechaInicio);			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdfechaFin_input=".urlencode($fechaFin);			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AnumeroConvocatoria=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input5."_collapsed=true";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AtxtNombreEntidad=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3AtxtRucEntidad=";			$data = $data."&tbBuscador%3AidFormBuscarProceso%3Atxtsigla=";			$data = $data."&javax.faces.ViewState=".urlencode($codViewState);			$ch		= curl_init();			curl_setopt($ch, CURLOPT_URL, $urlSitio);			curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);			curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);			curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);			curl_setopt($ch, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:80.0) Gecko/20100101 Firefox/80.0");			curl_setopt($ch, CURLOPT_HEADER, 0);			curl_setopt($ch, CURLOPT_COOKIE, 1);			curl_setopt($ch, CURLOPT_COOKIEJAR, "cookies/".$nombreArchivoCookie);			curl_setopt($ch, CURLOPT_COOKIEFILE, "cookies/".$nombreArchivoCookie);			curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 0);			curl_setopt($ch, CURLOPT_REFERER, $urlSitio);			curl_setopt($ch, CURLOPT_TIMEOUT, 20);			curl_setopt($ch, CURLOPT_POST, true);			curl_setopt($ch, CURLOPT_POSTFIELDS, $data);			$output	= curl_exec($ch);			$error	= curl_error($ch);			if ($error != "")			{				fn_Error($error);				$lvStr_ConError			= "true";			}			else			{				$posInicioRegistros		= strpos($output, '<![CDATA[');				if ($posInicioRegistros === false)				{					fn_Estado("No se encontraron datos (2).");					$lvStr_ConError		= "true";				}				else				{					$ch_osce			= curl_init();					$posFinRegistros	= strpos($output, ']]>', $posInicioRegistros);					$bloqueRegistros	= substr($output, $posInicioRegistros, $posFinRegistros - $posInicioRegistros);					$siguientePosicion	= 0;					$continuar			= true;					while ($continuar)					{						$posIniTr		= strpos($bloqueRegistros, '<tr', $siguientePosicion);						if ($posIniTr !== false)						{							$siguientePosicion	= $posIniTr;							$htmlFila			= "<tr>";							$htmlFilaExcel		= "<tr>";							$mostrarRegistro	= true;							for ($i = 1; $i <= 13; $i++)							{								$posIniCampo	= strpos($bloqueRegistros, '<td role="gridcell"', $siguientePosicion);								if ($posIniCampo === false)								{									fn_Error("No se encontraron datos (3).");									$lvStr_ConError	= "true";									break;								}								$posIniCampo2	= strpos($bloqueRegistros, '>', $posIniCampo);								$posFinCampo	= strpos($bloqueRegistros, '</td>', $posIniCampo2);								$contenidoCampo	= substr($bloqueRegistros, $posIniCampo2 + 1, $posFinCampo - $posIniCampo2 - 1);								if ($i == 10)								{									$valorNumerico	= fn_ConvertirANumero($contenidoCampo);									if ($valorMinimo != "")									{										if ($valorNumerico < (float) $valorMinimo)										{											$mostrarRegistro = false;											break;										}									}									$htmlFila		= $htmlFila."<td class='registroResultado'>".utf8_decode($contenidoCampo)."</td>";									$htmlFilaExcel	= $htmlFilaExcel."<td class='registroResultado'>".utf8_decode($contenidoCampo)."</td>";									$valorColumna7	= utf8_decode($contenidoCampo);								}								elseif (($i != 5) && ($i != 8) && ($i != 9) && ($i != 12) && ($i != 13))								{									$htmlFila		= $htmlFila."<td class='registroResultado'>".utf8_decode($contenidoCampo)."</td>";									$htmlFilaExcel	= $htmlFilaExcel."<td class='registroResultado'>".utf8_decode($contenidoCampo)."</td>";									switch ($i)									{										case 1:		$valorColumna1 = utf8_decode($contenidoCampo);													break;										case 2:		$valorColumna2 = utf8_decode($contenidoCampo);													break;										case 3:		$valorColumna3 = utf8_decode($contenidoCampo);													break;										case 4:		$valorColumna4 = utf8_decode($contenidoCampo);													break;										case 6:		$valorColumna5 = utf8_decode($contenidoCampo);													break;										case 7:		$valorColumna6 = utf8_decode($contenidoCampo);													break;										case 11:	$valorColumna8 = utf8_decode($contenidoCampo);													break;									}								}								elseif ($i == 13)								{									$posIniValoresDetalle	= strpos($contenidoCampo, 'dot_clear.gif');									if ($posIniValoresDetalle === false)									{										fn_Error("Error al obtener los valores para la ficha.");										$lvStr_ConError	= "true";										break;									}									$contenidoCampo	= substr($contenidoCampo, $posIniValoresDetalle);									$posIniDet1a	= strpos($contenidoCampo, 'dtProcesos:');									if ($posIniDet1a === false)									{										fn_Error("Error al obtener los valores para la ficha (campo 1a).");										$lvStr_ConError	= "true";										break;									}									$pos1			= $posIniDet1a + 11;									$pos2			= strpos($contenidoCampo, ":", $pos1);									$tbBuscador1	= substr($contenidoCampo, $pos1, $pos2 - $pos1);									$posIniDet1b	= strpos($contenidoCampo, 'j_idt', $posIniDet1a);									if ($posIniDet1b === false)									{										fn_Error("Error al obtener los valores para la ficha (campo 1b).");										$lvStr_ConError	= "true";										break;									}									$pos1			= $posIniDet1b;									$pos2			= strpos($contenidoCampo, "href=", $pos1);									$tbBuscador2	= substr($contenidoCampo, $pos1, $pos2 - $pos1 - 2);									$posIniDet2		= strpos($contenidoCampo, 'nidConvocatoria');									if ($posIniDet2 === false)									{										fn_Error("Error al obtener los valores para la ficha (campo 2).");										$lvStr_ConError	= "true";										break;									}									$pos1				= strpos($contenidoCampo, ":'", $posIniDet2);									$pos2				= strpos($contenidoCampo, "'", $pos1 + 2);									$nidConvocatoria	= substr($contenidoCampo, $pos1 + 2, $pos2 - $pos1 - 2);									$posIniDet3			= strpos($contenidoCampo, 'nidSistema');									if ($posIniDet3 === false)									{										fn_Error("Error al obtener los valores para la ficha (campo 3).");										$lvStr_ConError	= "true";										break;									}									$pos1			= strpos($contenidoCampo, ":'", $posIniDet3);									$pos2			= strpos($contenidoCampo, "'", $pos1 + 2);									$nidSistema		= substr($contenidoCampo, $pos1 + 2, $pos2 - $pos1 - 2);									$posIniDet4		= strpos($contenidoCampo, 'nidProceso');									if ($posIniDet4 === false)									{										fn_Error("Error al obtener los valores para la ficha (campo 4).");										$lvStr_ConError	= "true";										break;									}									$pos1			= strpos($contenidoCampo, ":'", $posIniDet4);									$pos2			= strpos($contenidoCampo, "'", $pos1 + 2);									$nidProceso		= substr($contenidoCampo, $pos1 + 2, $pos2 - $pos1 - 2);									$posIniDet5		= strpos($contenidoCampo, 'ntipo');									if ($posIniDet5 === false)									{										fn_Error("Error al obtener los valores para la ficha (campo 5).");										$lvStr_ConError	= "true";										break;									}									$pos1			= strpos($contenidoCampo, ":'", $posIniDet5);									$pos2			= strpos($contenidoCampo, "'", $pos1 + 2);									$ntipo			= substr($contenidoCampo, $pos1 + 2, $pos2 - $pos1 - 2);								}								$siguientePosicion = $posFinCampo + 1;							}							if ($lvStr_ConError == "true")							{								break;							}							if ($mostrarRegistro)							{								$data = "tbBuscador%3AidFormBuscarProceso=tbBuscador%3AidFormBuscarProceso";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AhddNumeroRuc=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AcodigoCaptcha=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AnombreEntidad=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input1."_input=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input1."_focus=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input2."_input=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input2."_focus=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AnumeroSeleccion=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdescripcionObjeto=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AanioConvocatoria_input=".$anioConvocatoria;								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AanioConvocatoria_focus=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input3."_input=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input3."_focus=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AcodigoSnip=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AsiglasEntidad=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input4."_input=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input4."_focus=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3Adepartamento_input=".$departamento;								$data = $data."&tbBuscador%3AidFormBuscarProceso%3Adepartamento_focus=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3Aprovincia_input=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3Aprovincia_focus=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3Adistrito_input=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3Adistrito_focus=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdfechaInicio_input=".urlencode($fechaInicio);								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdfechaFin_input=".urlencode($fechaFin);								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AnumeroConvocatoria=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3A".$input5."_collapsed=true";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AtxtNombreEntidad=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AtxtRucEntidad=";								$data = $data."&tbBuscador%3AidFormBuscarProceso%3Atxtsigla=";								$data = $data."&javax.faces.ViewState=".urlencode($codViewState);								$data = $data."&nidSistema=".$nidSistema;								$data = $data."&ptoRetorno=LOCAL";								$data = $data."&ntipo=".$ntipo;								$data = $data."&nidProceso=".$nidProceso;								$data = $data."&nidConvocatoria=".$nidConvocatoria;								$data = $data."&tbBuscador%3AidFormBuscarProceso%3AdtProcesos%3A".$tbBuscador1."%3A".$tbBuscador2."=tbBuscador%3AidFormBuscarProceso%3AdtProcesos%3A".$tbBuscador1."%3A".$tbBuscador2;								curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);								curl_setopt($ch, CURLOPT_URL, $urlSitio);								if ($lvBol_PrimerDetalle)								{									curl_setopt($ch, CURLOPT_REFERER, $urlSitio);								}								else								{									curl_setopt($ch, CURLOPT_REFERER, "https://prodapp2.seace.gob.pe/seacebus-uiwd-pub/fichaSeleccion/fichaSeleccion.xhtml");								};								curl_setopt($ch, CURLOPT_POST, true);								curl_setopt($ch, CURLOPT_POSTFIELDS, $data);								$lvBol_PrimerDetalle	= false;								$outputFicha			= curl_exec($ch);								$error					= curl_error ($ch);								if ($error != "")								{									fn_Error($error);									$lvStr_ConError		= "true";									break;								}								$info1		= curl_getinfo($ch);								$tempPagina	= strpos($info1["url"], "fichaSeleccion.xhtml");								if ($tempPagina === false)								{									fn_Error("Error al intentar obtener los datos de la ficha (1).");									$lvStr_ConError	= "true";									break;								}								$tempPosIdConv	= strpos($outputFicha, "Identificador Convocatoria:");								if ($tempPosIdConv === false)								{									fn_Error("Error al intentar obtener los datos de la ficha (2).");									$lvStr_ConError	= "true";									break;								}								$tempPorcion	= substr($outputFicha, $tempPosIdConv + 102, 8);								$idConv			= fn_BloqueTexto($tempPorcion, ">", "<");								if ($idConv == "")								{									fn_Error("Error al intentar obtener los datos de la ficha (3).");									$lvStr_ConError	= "true";									break;								}								if ($nidConvocatoria != $idConv)								{									fn_Error("Error al intentar obtener los datos de la ficha (4): ".$nidConvocatoria." / " .$idConv);									$lvStr_ConError	= "true";									break;								}								$tempPosOtorgamiento	= strpos($outputFicha, ">Otorgamiento de la Buena Pro<");								if ($tempPosOtorgamiento === false)								{									$fechaOtorgamiento	= "";								}								else								{									$tempPosFechaOtorgamiento	= strpos($outputFicha, '<td role="gridcell">', $tempPosOtorgamiento);									if ($tempPosFechaOtorgamiento === false)									{										fn_Error("Error al intentar obtener los datos de la ficha (7).");										$lvStr_ConError	= "true";										break;									}									$tempPorcion		= substr($outputFicha, $tempPosFechaOtorgamiento + 19);									$fechaOtorgamiento	= fn_BloqueTexto($tempPorcion, ">", "<");									if ($fechaOtorgamiento == "")									{										fn_Error("Error al intentar obtener los datos de la ficha (8).");										$lvStr_ConError	= "true";										break;									}								}								$htmlFila			= $htmlFila."<td class='registroResultado'>".utf8_decode($fechaOtorgamiento)."</td>";								$htmlFilaExcel		= $htmlFilaExcel."<td class='registroResultado'>".utf8_decode($fechaOtorgamiento)."</td>";								$valorColumna9		= utf8_decode($fechaOtorgamiento);								$tempPosListaItems	= strpos($outputFicha, '<div id="tbFicha:idGridLstItems_content"');								if ($tempPosListaItems === false)								{									fn_Error("Error al intentar obtener los datos de la ficha (8).");									$lvStr_ConError	= "true";									break;								}								$bloqueListaItems	= substr($outputFicha, $tempPosListaItems);								$htmlFila = $htmlFila."<td class='registroResultado'>";								$htmlFila = $htmlFila."<table class='tablaResultado'>";								$htmlFila = $htmlFila."<tr>";								$htmlFila = $htmlFila."<td class='tituloResultadoTablaInterna'>Descripci&oacute;n</td>";								$htmlFila = $htmlFila."<td class='tituloResultadoTablaInterna'>Postor</td>";								$htmlFila = $htmlFila."<td class='tituloResultadoTablaInterna'>Estado</td>";								$htmlFila = $htmlFila."<td class='tituloResultadoTablaInterna'>Monto Adj.</td>";								$htmlFila = $htmlFila."</tr>";								$lvBol_ContinuarItems		= true;								$lvBol_PrimeraFilaItems		= true;								$tempColumnaDatosContacto	= "";								$htmlFilaContactos			= "";								while ($lvBol_ContinuarItems)								{									$tempPosItem	= strpos($bloqueListaItems, '<tr class="ui-datagrid-row">');									if ($tempPosItem === false)									{										$lvBol_ContinuarItems	= false;									}									else									{										$bloqueListaItems	= substr($bloqueListaItems, $tempPosItem + 28);										$descripcionItem	= fn_BloqueTexto($bloqueListaItems, '<span style="font-weight: bold;">', '</span>');										$tempPosEstado		= strpos($bloqueListaItems, '<td><span style="font-weight:bold;">Estado:</span></td>');										if ($tempPosEstado === false)										{											$lvBol_ContinuarItems		= false;										}										else										{											$tempPorcion2				= substr($bloqueListaItems, $tempPosEstado + 55);											$estado						= fn_BloqueTexto($tempPorcion2, '<td>', '</td>');											$bloquePostor				= fn_BloqueTexto($bloqueListaItems, 'dtParticipantes_data', '</tbody>');											$lvBol_ContinuarPostores	= true;											$cadenaPostor				= "";											$cadenaPostorExcel			= "";											$cadenaMontoAdjudicado		= "";											$cadenaMontoAdjudicadoExcel	= "";											$cadenaDatosContactoExcel	= "";											while ($lvBol_ContinuarPostores)											{												$postor	= fn_BloqueTexto($bloquePostor, '<td role="gridcell"><span style="font-weight: bold;">', '</span>');												if ($postor == "")												{													$lvBol_ContinuarPostores = false;													if ($cadenaPostor == "")													{														$cadenaPostor		= fn_BloqueTexto($bloquePostor, '<td colspan="6">', '</td>');														$cadenaPostorExcel	= $cadenaPostor;													}												}												else												{													if ($cadenaPostor != "")													{														$cadenaPostor		= $cadenaPostor."<br />";														$cadenaPostorExcel	= $cadenaPostorExcel." | ";													}													$cadenaPostor			= $cadenaPostor.utf8_decode($postor);													$cadenaPostorExcel		= $cadenaPostorExcel.utf8_decode($postor);													$tempPosBloquePostor	= strpos($bloquePostor, '<td role="gridcell"><span style="font-weight: bold;">');													$bloquePostor			= substr($bloquePostor, $tempPosBloquePostor + 53);													$tempRucPostor			= substr($postor, 0, 11);													$tempPosMonto1			= strpos($bloquePostor, '<td role="gridcell">');													$tempPosMonto2			= strpos($bloquePostor, '<td role="gridcell">', $tempPosMonto1 + 20);													$tempPosMonto3			= strpos($bloquePostor, '<td role="gridcell">', $tempPosMonto2 + 20);													$tempPosMonto4			= strpos($bloquePostor, '<td role="gridcell">', $tempPosMonto3 + 20);													$tempPosMonto5			= strpos($bloquePostor, '<td role="gridcell">', $tempPosMonto4 + 20);													$bloqueMonto			= substr($bloquePostor, $tempPosMonto5);													$tempMonto				= fn_BloqueTexto($bloqueMonto, '<td role="gridcell">', '</td>');													if ($tempMonto != "")													{														if ($cadenaMontoAdjudicado != "")														{															$cadenaMontoAdjudicado		= $cadenaMontoAdjudicado."<br />";															$cadenaMontoAdjudicadoExcel	= $cadenaMontoAdjudicadoExcel." | ";														}														$cadenaMontoAdjudicado			= $cadenaMontoAdjudicado.utf8_decode($tempMonto);														$cadenaMontoAdjudicadoExcel		= $cadenaMontoAdjudicadoExcel.utf8_decode($tempMonto);													}													if (fn_EsRuc($tempRucPostor))													{														curl_setopt($ch_osce, CURLOPT_URL, "https://eap.osce.gob.pe/perfilprov-bus/1.0/ficha/".$tempRucPostor);														curl_setopt($ch_osce, CURLOPT_RETURNTRANSFER, true);														curl_setopt($ch_osce, CURLOPT_SSL_VERIFYPEER, false);														curl_setopt($ch_osce, CURLOPT_SSL_VERIFYHOST, false);														curl_setopt($ch_osce, CURLOPT_USERAGENT, "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:80.0) Gecko/20100101 Firefox/80.0");														curl_setopt($ch_osce, CURLOPT_HEADER, 0);														curl_setopt($ch_osce, CURLOPT_COOKIE, 1);														curl_setopt($ch_osce, CURLOPT_FOLLOWLOCATION, 0);														curl_setopt($ch_osce, CURLOPT_POST, false);														curl_setopt($ch_osce, CURLOPT_TIMEOUT, 5);														$output_osce	= curl_exec($ch_osce);														$error			= curl_error($ch_osce);														if ($error != "")														{															$error_code	= curl_errno($ch_osce);															if ($error_code == 28)															{																$tempColumnaDatosContacto	= $tempColumnaDatosContacto."<tr>";																$tempColumnaDatosContacto	= $tempColumnaDatosContacto."<td class='registroResultadoTablaInterna' style='color:#ff0000; font-weight:bold;' colspan='7'>Connection timed out</td>";																$tempColumnaDatosContacto	= $tempColumnaDatosContacto."</tr>";															}															else															{																fn_Error($error);																$lvStr_ConError	= "true";																break;															}														}														else														{															$objOutput	= json_decode($output_osce);															if ($objOutput->proveedorT01 == NULL)															{																$tempColumnaDatosContacto = $tempColumnaDatosContacto."<tr>";																$tempColumnaDatosContacto = $tempColumnaDatosContacto."<td class='registroResultadoTablaInterna' style='color:#ff0000; font-weight:bold;' colspan='7'>No se encontro el RUC ".$tempRucPostor." en el OSCE.</td>";																$tempColumnaDatosContacto = $tempColumnaDatosContacto."</tr>";															}															else															{																$nomRzsProv			= utf8_decode($objOutput->proveedorT01->nomRzsProv);																$ruc				= utf8_decode($objOutput->proveedorT01->numRuc);																$telefonos			= "";																$emails				= "";																$cmcTexto			= utf8_decode ($objOutput->proveedorT01->cmcTexto);																$sanciones			= utf8_decode ($objOutput->estadisticaT01->seccionSancionF01->datosEstadisticaT01->valor);																$penalidades		= utf8_decode ($objOutput->estadisticaT01->seccionPenalidadF01->datosEstadisticaT01->valor);																$codProv			= utf8_decode ($objOutput->proveedorT01->codProv);																$enlaceSanciones	= "<a target='_blank' href='https://apps.osce.gob.pe/perfilprov-ui/estadistica/".$codProv."#sanciones'>".$sanciones."</a>";																$enlacePenalidades	= "<a target='_blank' href='https://apps.osce.gob.pe/perfilprov-ui/estadistica/".$codProv."#penalidades'>".$penalidades."</a>";																for ($i = 0; $i < count($objOutput->proveedorT01->telefonos); $i++)																{																	$telefonos	= $telefonos.utf8_decode($objOutput->proveedorT01->telefonos[$i]);																	if ($i < count ($objOutput->proveedorT01->telefonos) - 1)																	{																		$telefonos	= $telefonos."<br />";																	}																}																for ($i = 0; $i < count($objOutput->proveedorT01->emails); $i++)																{																	$emails		= $emails.strtolower(utf8_decode($objOutput->proveedorT01->emails[$i]));																	if ($i < count ($objOutput->proveedorT01->emails) - 1)																	{																		$emails		= $emails."<br />";																	}																}																$tempColumnaDatosContacto = $tempColumnaDatosContacto."<tr>";																$tempColumnaDatosContacto = $tempColumnaDatosContacto."<td class='registroResultadoTablaInterna'>".$nomRzsProv."</td>";																$tempColumnaDatosContacto = $tempColumnaDatosContacto."<td class='registroResultadoTablaInterna'>".$ruc."</td>";																$tempColumnaDatosContacto = $tempColumnaDatosContacto."<td class='registroResultadoTablaInterna'>".$telefonos."</td>";																$tempColumnaDatosContacto = $tempColumnaDatosContacto."<td class='registroResultadoTablaInterna'>".$emails."</td>";																$tempColumnaDatosContacto = $tempColumnaDatosContacto."<td class='registroResultadoTablaInterna'>".$cmcTexto."</td>";																$tempColumnaDatosContacto = $tempColumnaDatosContacto."<td class='registroResultadoTablaInterna'>".$enlaceSanciones."</td>";																$tempColumnaDatosContacto = $tempColumnaDatosContacto."<td class='registroResultadoTablaInterna'>".$enlacePenalidades."</td>";																$tempColumnaDatosContacto = $tempColumnaDatosContacto."</tr>";																if ($cadenaDatosContactoExcel != "")																{																	$cadenaDatosContactoExcel	= $cadenaDatosContactoExcel." | ";																};																$cadenaDatosContactoExcel	= $cadenaDatosContactoExcel.$nomRzsProv." | ".$ruc." | ".$telefonos." | ".$emails." | ".$cmcTexto." | ".$enlaceSanciones." | ".$enlacePenalidades;																$htmlFilaContactos = $htmlFilaContactos."<tr>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$nomRzsProv."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$ruc."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$telefonos."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$emails."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$cmcTexto."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$enlaceSanciones."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$enlacePenalidades."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$valorColumna2."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$valorColumna3."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$valorColumna4."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$valorColumna5."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$valorColumna6."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$valorColumna7."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$valorColumna8."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$valorColumna9."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".utf8_decode($descripcionItem)."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$cadenaPostorExcel."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".utf8_decode($estado)."</td>";																$htmlFilaContactos = $htmlFilaContactos."<td class='registroResultadoTablaInterna'>".$cadenaMontoAdjudicadoExcel."</td>";																$htmlFilaContactos = $htmlFilaContactos."</tr>";															}														}													}												}											}											if ($lvStr_ConError == "true")											{												break;											}											$htmlFila = $htmlFila."<tr>";											$htmlFila = $htmlFila."<td class='registroResultadoTablaInterna' style='min-width:125px;'>".utf8_decode($descripcionItem)."</td>";											$htmlFila = $htmlFila."<td class='registroResultadoTablaInterna' style='min-width:125px;'>".$cadenaPostor."</td>";											$htmlFila = $htmlFila."<td class='registroResultadoTablaInterna' style='min-width:60px;'>".utf8_decode($estado)."</td>";											$htmlFila = $htmlFila."<td class='registroResultadoTablaInterna' style='min-width:60px;'>".$cadenaMontoAdjudicado."</td>";											$htmlFila = $htmlFila."</tr>";											if ($lvBol_PrimeraFilaItems)											{												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".utf8_decode($descripcionItem)."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$cadenaPostorExcel."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".utf8_decode($estado)."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$cadenaMontoAdjudicadoExcel."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$cadenaDatosContactoExcel."</td>";											}											else											{												$htmlFilaExcel = $htmlFilaExcel."</tr>";												$htmlFilaExcel = $htmlFilaExcel."<tr>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$valorColumna1."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$valorColumna2."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$valorColumna3."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$valorColumna4."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$valorColumna5."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$valorColumna6."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$valorColumna7."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$valorColumna8."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$valorColumna9."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".utf8_decode($descripcionItem)."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$cadenaPostorExcel."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".utf8_decode($estado)."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$cadenaMontoAdjudicadoExcel."</td>";												$htmlFilaExcel = $htmlFilaExcel."<td class='registroResultado'>".$cadenaDatosContactoExcel."</td>";											}										}									}									$lvBol_PrimeraFilaItems = false;								}								if ($lvStr_ConError == "true")								{									break;								}								$htmlFila	= $htmlFila."</table>";								$htmlFila	= $htmlFila."</td>";								if ($tempColumnaDatosContacto != "")								{									$tempCabeceraDatosContacto = "";									$tempCabeceraDatosContacto = $tempCabeceraDatosContacto."<table class='tablaResultado'>";									$tempCabeceraDatosContacto = $tempCabeceraDatosContacto."<tr>";									$tempCabeceraDatosContacto = $tempCabeceraDatosContacto."<td class='tituloResultadoTablaInterna'>Nombre</td>";									$tempCabeceraDatosContacto = $tempCabeceraDatosContacto."<td class='tituloResultadoTablaInterna'>RUC</td>";									$tempCabeceraDatosContacto = $tempCabeceraDatosContacto."<td class='tituloResultadoTablaInterna'>Telefono</td>";									$tempCabeceraDatosContacto = $tempCabeceraDatosContacto."<td class='tituloResultadoTablaInterna'>Email</td>";									$tempCabeceraDatosContacto = $tempCabeceraDatosContacto."<td class='tituloResultadoTablaInterna'>CMC</td>";									$tempCabeceraDatosContacto = $tempCabeceraDatosContacto."<td class='tituloResultadoTablaInterna'>Sanciones</td>";									$tempCabeceraDatosContacto = $tempCabeceraDatosContacto."<td class='tituloResultadoTablaInterna'>Penalidades</td>";									$tempCabeceraDatosContacto = $tempCabeceraDatosContacto."</tr>";									$htmlFila	= $htmlFila."<td class='registroResultado'>".$tempCabeceraDatosContacto.$tempColumnaDatosContacto."</table></td>";								}								else								{									$htmlFila	= $htmlFila."<td class='registroResultado'></td>";								}								$htmlFila		= $htmlFila."</tr>";								$htmlFilaExcel	= $htmlFilaExcel."</tr>";								echo("fn_AgregarFila('".fn_TextoAjax($htmlFila)."', '".fn_TextoAjax($htmlFilaExcel)."', '".fn_TextoAjax($htmlFilaContactos)."');");							}						}						else						{							$continuar	= false;						}					}				}			}			curl_close($ch);		}		if (($nroPaginaActual == $cantPaginas) || ($lvStr_ConError == "true"))		{			echo("fn_FinTabla(".$lvStr_ConError.");");			$nombreArchivo	= $_POST["nombreArchivo"];			fn_LimpiarSesion($nombreArchivo, $nombreArchivoCookie);		}		else		{			echo("fn_ObtenerDatosPagina('".($nroPaginaActual + 1)."');");		}	}}if (isset($_POST["guardarTablaParaExcel"])){	if ($_POST["guardarTablaParaExcel"] == "1")	{		$tabla						= $_POST["tablaVisualizacion"];		$departamento				= $_POST["departamento"];		$fechaInicio				= $_POST["fechaInicio"];		$fechaFin					= $_POST["fechaFin"];		$key						= rand(0, 9999);		$tokenArchivoVisualizacion	= substr(md5($key), 0, 8);		$nombreArchivo				= "excel-".$tokenArchivoVisualizacion.".html";		$fileHandle					= fopen("excel/".$nombreArchivo, "w");		fwrite($fileHandle, $tabla);		fclose($fileHandle);		$tabla						= $_POST["tablaTrabajo"];		$key						= rand(0, 9999);		$tokenArchivoTrabajo		= substr(md5($key), 0, 8);		$nombreArchivo				= "excel-".$tokenArchivoTrabajo.".html";		$fileHandle					= fopen("excel/".$nombreArchivo, "w");		fwrite($fileHandle, $tabla);		fclose($fileHandle);		$tabla						= $_POST["tablaContactos"];		$key						= rand(0, 9999);		$tokenArchivoContactos		= substr(md5($key), 0, 8);		$nombreArchivo				= "excel-".$tokenArchivoContactos.".html";		$fileHandle					= fopen("excel/".$nombreArchivo, "w");		fwrite($fileHandle, $tabla);		fclose($fileHandle);		$paramDepto					= fn_NombreDepartamentoParaExcel($departamento);		$paramFechaDesde			= fn_FormatoFechaParaExcel($fechaInicio);		$paramFechaHasta			= fn_FormatoFechaParaExcel($fechaFin);		$paramFechaActual			= date("Y-m-d");		$nombreArchivoVisualizacion	= "V-".$paramDepto."-[FF.".$paramFechaHasta."]-[FI.".$paramFechaDesde."]-[FD.".$paramFechaActual."].xls";		$nombreArchivoTrabajo		= "T-".$paramDepto."-[FF.".$paramFechaHasta."]-[FI.".$paramFechaDesde."]-[FD.".$paramFechaActual."].xls";		$nombreArchivoContactos		= "C-".$paramDepto."-[FF.".$paramFechaHasta."]-[FI.".$paramFechaDesde."]-[FD.".$paramFechaActual."].xls";		echo("fn_TablaGuardadaParaExcel('".$nombreArchivoVisualizacion."', '".$nombreArchivoTrabajo."', '".$nombreArchivoContactos."', '".$tokenArchivoVisualizacion."', '".$tokenArchivoTrabajo."', '".$tokenArchivoContactos."');");	}}?>